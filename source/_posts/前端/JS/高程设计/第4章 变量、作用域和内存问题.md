---
title: 第4章 变量、作用域和内存问题
cover: false
categories:
  - 前端
  - JS
  - 高程设计
tags:
  - 变量
  - 作用域
  - 内存
abbrlink: 14f12f91
date: 2020-07-15 23:54:41
---
## 基本类型和引用类型
- 基本类型：Undefined、Null、Boolean、Number和String，按值访问。
- 引用类型：Object，保存在内存中的对象，实际操作的是该值的引用。

动态的属性：引用类型的对象可以添加自己的属性和方法，基本类型的不能。

复制变量值：引用类型复制的是引用指针，修改复制后的值也会改变原来的值，基本类型的是两个独立的值。

### 检测类型
`typeof`操作符可以检测基本类型数值对应的类型，但引用类型只能得到object，`instanceof`操作符可以更加具体地确定哪种对象。

Safari和Chrome使用typeof检测正则表达式时，返回`function`，而IE和Firefox得到`object`。

## 执行环境和作用域
执行环境定义了变量和函数有权访问的其他数据，每一个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在这个对象中。

全局执行环境被认为是window对象

多个不同环境的变量对象会构成一条作用域链，作用域链底部的变量对象可以访问高层次的变量，反之则不行，这其实是后来ES6定义的闭包。
> 局部环境可以访问父环境，乃至全局环境的变量，反之则不然。

## 垃圾收集
JS具有自动垃圾收集机制，执行环境会自己管理代码执行过程中使用的内存。

这种自动的机制，其实就是周期性地寻找那些不再继续使用的变量（生命周期结束），然后释放它的内存。
> 这种如何周期性地触发回收机制，关系到浏览器的性能。

寻找的过程通常有两种策略：
- 标记清除
	> 标记所有变量，识别出那些在环境中使用的，清除标记，还有标记的就是要回收的变量
- 引用计数
	> 跟踪记录每个值被引用的次数，清除掉计数为0的变量

引用计数方法可能导致有些变量循环引用，计数无法为0，无法清除，导致内存泄漏，因此并不常用。

有时候，手动地将全局对象或循环引用的变量赋值为null，可以解除该变量的引用，方便垃圾回收机制下一次运行清除掉它。
> 局部变量不必如此，当执行环境改变时，它们就有可能被自动清除了

